<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://privsyn-tabular-docs.vercel.app/deployment/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Deployment - PrivSyn Tabular Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">PrivSyn Tabular Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Overview</a>
                            </li>
                            <li class="nav-item">
                                <a href="../frontend/" class="nav-link">Frontend</a>
                            </li>
                            <li class="nav-item">
                                <a href="../backend/" class="nav-link">Backend</a>
                            </li>
                            <li class="nav-item">
                                <a href="../testing/" class="nav-link">Testing</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Deployment</a>
                            </li>
                            <li class="nav-item">
                                <a href="../privacy/" class="nav-link">Privacy</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Reference</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../docs-map/" class="dropdown-item">Documentation Map</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../testing/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../privacy/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/vvv214/privsyn-tabular/edit/master/docs/deployment.md" class="nav-link">Edit on vvv214/privsyn-tabular
                                    </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#deployment-guide" class="nav-link">Deployment Guide</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#1-local-docker-image" class="nav-link">1. Local Docker Image</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#2-google-cloud-run" class="nav-link">2. Google Cloud Run</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#3-vercel-frontend-hosted-backend" class="nav-link">3. Vercel Frontend + Hosted Backend</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#4-environment-variables" class="nav-link">4. Environment Variables</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#5-storage-sessions" class="nav-link">5. Storage &amp; Sessions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#6-health-checks" class="nav-link">6. Health Checks</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="deployment-guide">Deployment Guide<a class="headerlink" href="#deployment-guide" title="Permanent link">&para;</a></h1>
<p>This document outlines the most common deployment paths for the PrivSyn web application—local Docker usage, Google Cloud Run, and Vercel (frontend). It highlights the environment variables you need to set and the expected directory layout.</p>
<h2 id="1-local-docker-image">1. Local Docker Image<a class="headerlink" href="#1-local-docker-image" title="Permanent link">&para;</a></h2>
<ol>
<li>Build the image:
   <code>bash
   docker build -t privsyn-tabular .</code></li>
<li>Run the container, exposing the FastAPI port:
   <code>bash
   docker run --rm -p 8080:8080 \
     -e VITE_API_BASE_URL="http://localhost:8080" \
     privsyn-tabular</code></li>
<li>The backend listens on <code>$PORT</code> (defaults to <code>8080</code> for Cloud Run compatibility). The Dockerfile bundles the built frontend under <code>web_app/static/</code>, so no additional proxy is required.</li>
</ol>
<h2 id="2-google-cloud-run">2. Google Cloud Run<a class="headerlink" href="#2-google-cloud-run" title="Permanent link">&para;</a></h2>
<ol>
<li>Build and push the container:
   <code>bash
   gcloud builds submit --tag gcr.io/&lt;PROJECT_ID&gt;/privsyn</code></li>
<li>Deploy to Cloud Run:
   <code>bash
   gcloud run deploy privsyn \
     --image gcr.io/&lt;PROJECT_ID&gt;/privsyn \
     --platform managed \
     --allow-unauthenticated \
     --set-env-vars="VITE_API_BASE_URL=https://&lt;service-url&gt;"</code></li>
<li>Configure Cloud Run service variables:</li>
<li><code>VITE_API_BASE_URL</code>: the public URL of the service if you intend to serve the frontend from the same container.</li>
<li><code>CORS_ALLOW_ORIGINS</code>: optional comma-separated list of additional origins to append to the defaults in <code>web_app/main.py</code>.</li>
</ol>
<blockquote>
<p><strong>Free tier constraints:</strong> the Cloud Run free tier grants limited CPU, RAM, and request duration. Large uploads or AIM runs frequently exceed those caps, leading to timeouts or OOM restarts. For heavy workloads, pull the code locally (or to a beefier VM) and run the backend outside Cloud Run.</p>
</blockquote>
<h3 id="21-continuous-deployment-from-github-actions">2.1 Continuous deployment from GitHub Actions<a class="headerlink" href="#21-continuous-deployment-from-github-actions" title="Permanent link">&para;</a></h3>
<p>Automated deployments run via <code>.github/workflows/deploy-cloudrun.yml</code> whenever <code>main</code> is updated. The workflow:</p>
<ol>
<li>Checks out the repository.</li>
<li>Authenticates to GCP using <code>GCP_SA_KEY</code> (a JSON service-account key stored as a GitHub secret).</li>
<li>Builds and pushes <code>gcr.io/gen-lang-client-0649776758/privsyn-tabular</code> via <code>gcloud builds submit</code>.</li>
<li>Deploys the image to Cloud Run in <code>us-east4</code> with <code>--allow-unauthenticated</code>.</li>
</ol>
<p>To keep it working you must ensure the following GitHub secrets are defined:</p>
<table>
<thead>
<tr>
<th>Secret</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GCP_SA_KEY</code></td>
<td>Service-account JSON with roles <code>Cloud Run Admin</code>, <code>Cloud Build Editor</code>, <code>Service Account User</code>.</td>
</tr>
</tbody>
</table>
<p>The project (<code>gen-lang-client-0649776758</code>), region (<code>us-east4</code>), and image name are baked into the workflow. If you need a different target, update <code>.github/workflows/deploy-cloudrun.yml</code>.</p>
<h2 id="3-vercel-frontend-hosted-backend">3. Vercel Frontend + Hosted Backend<a class="headerlink" href="#3-vercel-frontend-hosted-backend" title="Permanent link">&para;</a></h2>
<ol>
<li>Deploy the backend (Docker, Cloud Run, or elsewhere) and note the public base URL.</li>
<li>In the Vercel project (or other static hosting provider):</li>
<li>Set <code>VITE_API_BASE_URL</code> to the backend URL.</li>
<li>Run <code>npm run build</code> to produce <code>frontend/dist</code>.</li>
<li>Serve the built assets or configure Vercel to use the static output directory.</li>
<li>Update <code>allow_origins</code> in <code>web_app/main.py</code> to include the Vercel domain.</li>
</ol>
<h2 id="4-environment-variables">4. Environment Variables<a class="headerlink" href="#4-environment-variables" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Purpose</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>VITE_API_BASE_URL</code></td>
<td>Frontend → backend URL.</td>
<td><code>http://127.0.0.1:8001</code></td>
</tr>
<tr>
<td><code>CORS_ALLOW_ORIGINS</code></td>
<td>Optional extra origins; comma separated.</td>
<td>—</td>
</tr>
<tr>
<td><code>PORT</code></td>
<td>FastAPI listening port (Cloud Run).</td>
<td><code>8080</code></td>
</tr>
<tr>
<td><code>LOG_LEVEL</code></td>
<td>Optional override for FastAPI logging level.</td>
<td><code>INFO</code></td>
</tr>
</tbody>
</table>
<h2 id="5-storage-sessions">5. Storage &amp; Sessions<a class="headerlink" href="#5-storage-sessions" title="Permanent link">&para;</a></h2>
<ul>
<li>Temporary artifacts (uploaded parquet files, synthesized CSVs) are stored under <code>temp_synthesis_output/runs/{session_id}</code>.</li>
<li>Sessions expire automatically after six hours. For production, consider pointing the session store to Redis or another durable cache.</li>
<li>Use a cron or Cloud Run job to prune <code>temp_synthesis_output</code> if you retain disk between deployments.</li>
</ul>
<h2 id="6-health-checks">6. Health Checks<a class="headerlink" href="#6-health-checks" title="Permanent link">&para;</a></h2>
<ul>
<li>Use <code>GET /</code> for a lightweight ping.</li>
<li>To simulate the metadata flow without a real upload, POST to <code>/synthesize</code> with <code>dataset_name=debug_dataset</code> (returns stub metadata).</li>
</ul>
<p>Refer to <code>docs/testing.md</code> for CI-friendly commands to verify the deployment image before shipping.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
